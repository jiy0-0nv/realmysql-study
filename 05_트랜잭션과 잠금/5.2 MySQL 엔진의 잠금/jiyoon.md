# 5.2 MySQL 엔진의 잠금

- 엔진 레벨과 스토리지 엔진 레벨로 구분  
  
  - 엔진 레벨 잠금: 모든 스토리지 엔진에 영향 
    - 글로벌 락, 백업 락, 테이블 락, 네임드 락, 메타데이터 락 등
  
  - 스토리지 엔진 레벨 잠금: 각 엔진 내부에서만 동작  

- 동시성 제어와 변경 안전성을 높이면서 서비스 지연과 교착을 최소화해야 함



## 5.2.1 글로벌 락과 백업 락

- 글로벌 락  
  
  - `{FLUSH TABLES WITH READ LOCK}`
  
  - 획득 시 SELECT를 제외한 대부분의 DML·DDL이 대기 상태로 전환
  
  - 서버 전역 범위에 적용
    - 테이블·데이터베이스가 달라도 동일하게 영향
  
  - 긴 쿼리/트랜잭션이 선행 중이면 락 획득 자체가 지연
  
  - 온라인 서비스 환경에서는 사용 지양

- 백업 락  
  
  - `{LOCK INSTANCE FOR BACKUP}` + `{UNLOCK INSTANCE}`로 사용
  
  - DDL 및 계정, 권한 변경을 차단 / 일반 DML은 허용 
  
  - InnoDB 기반의 일관 백업을 안정적으로 수행하기 위한 경량 전역 락
  
  - 복제 환경에서 백업 시 스키마 변경으로 인한 백업 실패를 방지하는 목적에 적합


    || 글로벌 락 `{FTWRL}` | 백업 락 `{LOCK INSTANCE FOR BACKUP}` |
    |---|---|---|
    | 적용 범위 | 서버 전역 | 서버 전역 |
    | SELECT | 허용 | 허용 |
    | DML | 대부분 대기 | 허용 |
    | DDL 및 계정 변경 | 대기 | 차단 |
    | 테이블 플러시 / 닫기 | 즉시 수행 | 불필요 |
    | 주 용도 | MyISAM/MEMORY 일관 백업, 전역 정지 | InnoDB 일관 백업 시 스키마 변경 방지 |
    | 운영 리스크 | 매우 큼, 서비스 지연 초래 위험 | 상대적으로 작음 |



## 5.2.2 테이블 락

- 명시적 테이블 락  
  
  - `{LOCK TABLES tbl READ|WRITE}`로 획득 / `{UNLOCK TABLES}`로 해제
  
  - MyISAM/InnoDB 관계없이 설정 가능하지만 온라인 서비스에 영향이 큼
  
  - 사용 지양

- 묵시적 테이블 락  
  
  - MyISAM/MEMORY에서 DML 실행 시 자동 획득/해제됨  
  
  - InnoDB는 레코드 기반 잠금을 사용하므로 일반 DML에는 테이블 락 영향 미미
  
  - InnoDB에서도 DDL 시에는 테이블 단위 영향 발생

